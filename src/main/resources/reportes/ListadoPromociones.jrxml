<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="ListadoPromociones" pageWidth="595" pageHeight="842" whenNoDataType="AllSectionsNoDetail" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="SupermercadoDB"/>
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	
	<style name="Title" forecolor="#00796B" fontName="SansSerif" fontSize="26" isBold="true"/>
	<style name="CatHeader" mode="Opaque" backcolor="#00796B" forecolor="#FFFFFF" fontName="SansSerif" fontSize="14" isBold="true"/>
	<style name="PromoCard" mode="Opaque" backcolor="#F5F5F5">
		<box>
			<pen lineWidth="1.0" lineColor="#CCCCCC"/>
		</box>
	</style>
	<style name="PromoTitle" forecolor="#333333" fontName="SansSerif" fontSize="14" isBold="true"/>
	<style name="PromoDetail" forecolor="#666666" fontName="SansSerif" fontSize="10"/>
	<style name="PriceBadge" mode="Opaque" backcolor="#E0F2F1" forecolor="#00796B" fontName="SansSerif" fontSize="12" isBold="true"/>

	<queryString language="SQL">
		<![CDATA[SELECT 
    p.nombrePromocion,
    p.unidadesAfectadas,
    p.precioPorUnidad,
    p.fechaInicio,
    p.fechaFin,
    p.reglas,
    p.aplicableA,
    c.nombre AS nombreCategoria,
    DATEDIFF(p.fechaFin, CURDATE()) AS diasRestantes
FROM Promociones p
JOIN Categoria c ON p.Categoria_idCategoria = c.idCategoria
WHERE (p.fechaFin >= CURDATE() OR p.fechaFin IS NULL)
ORDER BY c.nombre ASC, p.fechaFin ASC]]>
	</queryString>

	<field name="nombrePromocion" class="java.lang.String"/>
	<field name="unidadesAfectadas" class="java.lang.Integer"/>
	<field name="precioPorUnidad" class="java.math.BigDecimal"/>
	<field name="fechaInicio" class="java.sql.Date"/>
	<field name="fechaFin" class="java.sql.Date"/>
	<field name="reglas" class="java.lang.String"/>
	<field name="aplicableA" class="java.lang.String"/>
	<field name="nombreCategoria" class="java.lang.String"/>
	<field name="diasRestantes" class="java.lang.Long"/>

	<group name="CategoriaGroup">
		<groupExpression><![CDATA[$F{nombreCategoria}]]></groupExpression>
		<groupHeader>
			<band height="40">
				<rectangle radius="5">
					<reportElement x="0" y="10" width="555" height="25" backcolor="#00796B"/>
					<graphicElement><pen lineWidth="0.0"/></graphicElement>
				</rectangle>
				<textField>
					<reportElement x="15" y="10" width="400" height="25" forecolor="#FFFFFF"/>
					<textElement verticalAlignment="Middle">
						<font size="14" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{nombreCategoria}.toUpperCase()]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
	</group>

	<background>
		<band splitType="Stretch"/>
	</background>

	<title>
		<band height="90" splitType="Stretch">
			<staticText>
				<reportElement style="Title" x="0" y="10" width="450" height="40"/>
				<text><![CDATA[Promociones Activas]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="50" width="300" height="20" forecolor="#666666"/>
				<textElement>
					<font size="12"/>
				</textElement>
				<text><![CDATA[Listado de ofertas vigentes a fecha de hoy.]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy">
				<reportElement x="450" y="20" width="105" height="20"/>
				<textElement textAlignment="Right">
					<font size="12" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="0" y="80" width="555" height="1" forecolor="#00796B"/>
				<graphicElement><pen lineWidth="2.0"/></graphicElement>
			</line>
		</band>
	</title>

	<detail>
		<band height="90" splitType="Stretch">
			<frame>
				<reportElement style="PromoCard" x="10" y="5" width="535" height="80"/>
				
				<textField>
					<reportElement style="PromoTitle" x="10" y="5" width="350" height="20"/>
					<textFieldExpression><![CDATA[$F{nombrePromocion}]]></textFieldExpression>
				</textField>

				<staticText>
					<reportElement style="PromoDetail" x="10" y="30" width="60" height="15"/>
					<textElement><font isBold="true"/></textElement>
					<text><![CDATA[Vigencia:]]></text>
				</staticText>
				<textField pattern="dd/MM/yyyy">
					<reportElement style="PromoDetail" x="70" y="30" width="200" height="15"/>
					<textFieldExpression><![CDATA[($F{fechaInicio} != null ? new java.text.SimpleDateFormat("dd/MM/yyyy").format($F{fechaInicio}) : "") + " hasta " + ($F{fechaFin} != null ? new java.text.SimpleDateFormat("dd/MM/yyyy").format($F{fechaFin}) : "Indefinida")]]></textFieldExpression>
				</textField>

				<staticText>
					<reportElement style="PromoDetail" x="10" y="50" width="60" height="15"/>
					<textElement><font isBold="true"/></textElement>
					<text><![CDATA[Detalles:]]></text>
				</staticText>
				<textField>
					<reportElement style="PromoDetail" x="70" y="50" width="300" height="25"/>
					<textFieldExpression><![CDATA[($F{reglas} != null ? $F{reglas} : "Sin reglas especiales") + " (" + ($F{aplicableA} != null ? $F{aplicableA} : "General") + ")"]]></textFieldExpression>
				</textField>

				<rectangle radius="5">
					<reportElement x="400" y="10" width="120" height="60" backcolor="#E0F2F1"/>
					<graphicElement><pen lineWidth="1.0" lineColor="#00796B"/></graphicElement>
				</rectangle>
				<textField>
					<reportElement x="400" y="15" width="120" height="20" forecolor="#00796B"/>
					<textElement textAlignment="Center">
						<font size="10"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{unidadesAfectadas} + " Uds. por"]]></textFieldExpression>
				</textField>
				<textField pattern="#,##0.00 ¤">
					<reportElement x="400" y="35" width="120" height="30" forecolor="#00796B"/>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="18" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{precioPorUnidad}]]></textFieldExpression>
				</textField>

				<textField>
					<reportElement x="300" y="5" width="90" height="15" forecolor="#D32F2F">
						<printWhenExpression><![CDATA[$F{diasRestantes} != null && $F{diasRestantes} < 7]]></printWhenExpression>
					</reportElement>
					<textElement textAlignment="Right">
						<font size="9" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA["¡Acaba en " + $F{diasRestantes} + " días!"]]></textFieldExpression>
				</textField>
			</frame>
		</band>
	</detail>

	<pageFooter>
		<band height="30">
			<textField>
				<reportElement x="0" y="0" width="555" height="20" forecolor="#999999"/>
				<textElement textAlignment="Center"/>
				<textFieldExpression><![CDATA["Boquerón Tech - Pág. " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
</jasperReport>
